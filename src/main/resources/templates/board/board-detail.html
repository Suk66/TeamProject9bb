<!DOCTYPE html>
<html lang="en" layout:decorate="~{layouts/layout}"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <title>ê²Œì‹œíŒ ìƒì„¸íšŒì› í˜ì´ì§€</title>

    <style>
        * { font-family: "Merriweather", serif; }
        .mytitle { height: 200px; color: white; display: flex; align-items: center; justify-content: center; background-color: #343a40; }
        .mypostingbox { width: 60%; margin: 30px auto; padding: 20px; box-shadow: 0px 0px 5px 0px gray; border-radius: 5px; }
    </style>

</head>

<body>
<main layout:fragment="content">

<div class="mytitle">
    <h1>ê²Œì‹œê¸€ ìƒì„¸</h1>
</div>

<div class="mypostingbox">
    <h2 th:text="${board.title}"></h2>
    <p><strong>ì‘ì„±ì:</strong> <span th:text="${board.writer}"></span></p>
    <p><strong>ì‘ì„±ì¼:</strong> <span th:text="${#temporals.format(board.createdAt, 'yyyy-MM-dd HH:mm')}"></span></p>
    <hr>
    <p th:text="${board.content}"></p>
    <hr>
    <a href="/board" class="btn btn-outline-dark">ëª©ë¡ìœ¼ë¡œ</a>

    <!-- ğŸ“Œ ì˜¤ë¥˜ ìˆ˜ì •: ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì´ë©”ì¼ í‘œì‹œ -->
    <p>ğŸ“Œ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì´ë©”ì¼:
        <span th:if="${session.user != null}" th:text="${session.user.email}"></span>
        <span th:unless="${session.user != null}">ë¹„ë¡œê·¸ì¸ ìƒíƒœ</span>
    </p>

    <p>ğŸ“Œ ê²Œì‹œê¸€ ì‘ì„±ì ì´ë©”ì¼: <span th:text="${board.writer}"></span></p>

    <!-- ğŸ“Œ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì == ì‘ì„±ì (ìˆ˜ì • ê°€ëŠ¥) -->
    <a th:if="${session.user != null and session.user.email == board.writer}"
       th:href="@{/board/edit/{id}(id=${board.boardId})}"
       class="btn btn-warning">
        ìˆ˜ì •
    </a>

    <!-- ğŸ“Œ ë¹„ë¡œê·¸ì¸ ìƒíƒœì—ì„œ ë¹„ë¡œê·¸ì¸ ì‘ì„± ê¸€ë§Œ ìˆ˜ì • ê°€ëŠ¥ (ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ìš”) -->
    <a th:if="${session.user == null and board.writer != null and board.writer.indexOf('@') == -1}"
       th:href="@{/board/check-password/{id}(id=${board.boardId})}"
       class="btn btn-warning">
        ìˆ˜ì • (ë¹„ë°€ë²ˆí˜¸ ì…ë ¥)
    </a>

    <!-- ğŸ“Œ ë¡œê·¸ì¸ ìƒíƒœì—ì„œ ë¹„ë¡œê·¸ì¸ ì‘ì„± ê¸€ë§Œ ìˆ˜ì • ê°€ëŠ¥ (ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ìš”) -->
    <a th:if="${session.user != null and board.writer != null and board.writer.indexOf('@') == -1}"
       th:href="@{/board/check-password/{id}(id=${board.boardId})}"
       class="btn btn-warning">
        ìˆ˜ì • (ë¹„ë°€ë²ˆí˜¸ ì…ë ¥)
    </a>










</div>

<script>
    function deleteBoard(boardId) {
        console.log("ğŸ“Œ [ë””ë²„ê¹…] ì‚­ì œ ìš”ì²­ ID:", boardId);

        if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            fetch(`/board/delete/${boardId}`, { method: "POST" })
                .then(response => {
                    console.log("ğŸ“Œ [ë””ë²„ê¹…] ì„œë²„ ì‘ë‹µ ìƒíƒœ:", response.status);
                    if (!response.ok) {
                        throw new Error("ì‚­ì œ ìš”ì²­ ì‹¤íŒ¨!");
                    }
                    return response.text();
                })
                .then(() => {
                    alert("ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                    window.location.href = "/board";
                })
                .catch(error => {
                    console.error("âŒ [ì˜¤ë¥˜] ì‚­ì œ ìš”ì²­ ì‹¤íŒ¨:", error);
                    alert("ì‚­ì œ ì‹¤íŒ¨! ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.");
                });
        }
    }
</script>
</main>
</body>

</html>