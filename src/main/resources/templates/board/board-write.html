<!DOCTYPE html>
<html lang="en" layout:decorate="~{layouts/layout}"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
  <meta charset="UTF-8">
  <title>ê²Œì‹œê¸€ ì‘ì„±</title>
</head>
<body>
<main layout:fragment="content">

<div class="container mt-5">
  <h2>ê²Œì‹œê¸€ ì‘ì„±</h2>

  <!-- âœ… ê²Œì‹œê¸€ ì‘ì„± í¼ -->
  <form action="/board/write" method="post" onsubmit="return validateForm()">
    <div class="mb-3">
      <label class="form-label">ì œëª©</label>
      <input type="text" class="form-control" name="title" required>
    </div>

    <div class="mb-3">
      <label class="form-label">ì‘ì„±ì</label>

      <!-- âœ… ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ìëŠ” ì§ì ‘ ì…ë ¥ -->
      <input type="text" class="form-control"
             th:if="${session.user == null}" name="writer" required>

      <!-- âœ… ë¡œê·¸ì¸ ì‚¬ìš©ìëŠ” ìë™ ì…ë ¥ (readonly) -->
      <input type="text" class="form-control"
             th:if="${session.user != null}"
             th:value="${session.user.name}" name="displayWriter" readonly>

      <!-- âœ… ì´ë©”ì¼ì„ hidden í•„ë“œë¡œ ì¶”ê°€í•´ì„œ ì„œë²„ë¡œ ì „ì†¡ -->
      <input type="hidden" name="writer"
             th:if="${session.user != null}"
             th:value="${session.user.email}">
    </div>

    <div class="mb-3">
      <label class="form-label">ë‚´ìš©</label>
      <textarea class="form-control" name="content" rows="5" required></textarea>
    </div>

    <!-- âœ… ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ìë§Œ ë³´ì´ê²Œ ì„¤ì •) -->
    <div id="passwordField" class="form-floating mb-3">
      <input type="password" class="form-control" id="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
      <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
    </div>

    <button type="submit" class="btn btn-primary">ì‘ì„± ì™„ë£Œ</button>
    <a href="/board" class="btn btn-secondary">ì·¨ì†Œ</a>

    <p>ğŸ“Œ ì„¸ì…˜ ì‚¬ìš©ì ì •ë³´: <span th:text="${session.user}"></span></p>


  </form>
</div>

<!-- âœ… ë¡œê·¸ì¸ ì—¬ë¶€ í™•ì¸ -->
<input type="hidden" id="isLoggedIn" th:value="${session.user != null}">

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const isLoggedIn = document.getElementById("isLoggedIn").value === "true";
    if (isLoggedIn) {
      document.getElementById("passwordField").style.display = "none";  // ë¡œê·¸ì¸í•œ ì‚¬ìš©ìëŠ” ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ X
    }
  });

  function validateForm() {
    const isLoggedIn = document.getElementById("isLoggedIn").value === "true";
    const password = document.getElementById("password").value;

    if (!isLoggedIn && !password) {
      alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
      return false;
    }
    return true;
  }
</script>

</main>
</body>
</html>